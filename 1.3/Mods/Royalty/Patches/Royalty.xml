<?xml version="1.0" encoding="utf-8" ?>
<Patch>

    <!-- Hide old techs & Remove prerequisites -->

    <!-- Medieval -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "NobleApparel"
                or defName = "RoyalApparel"
                or defName = "Harp"
                or defName = "Harpsichord"
            ]
        </xpath>
        <value>
            <tab>DuneRef_Hidden</tab>
        </value>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "NobleApparel"
                or defName = "RoyalApparel"
                or defName = "Harp"
                or defName = "Harpsichord"
            ]/prerequisites
        </xpath>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "RoyalApparel"
            ]/hiddenPrerequisites
        </xpath>
    </Operation>

    <!-- Add techs to RimCivTechTree researches -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_ComplexClothworking"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>NobleApparel</li>
            <li>RoyalApparel</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_ExpandedCulture"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>Harp</li>
            <li>Harpsichord</li>
        </value>
    </Operation>

    <!-- Industrial -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "JumpPack"
                or defName = "Gunlink"
                or defName = "Piano"
            ]
        </xpath>
        <value>
            <tab>DuneRef_Hidden</tab>
        </value>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "JumpPack"
                or defName = "Gunlink"
                or defName = "Piano"
            ]/prerequisites
        </xpath>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "JumpPack"
            ]/hiddenPrerequisites
        </xpath>
    </Operation>

    <!-- Add techs to RimCivTechTree researches -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_PredictiveSystems"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>JumpPack</li>
            <li>Gunlink</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_ExpandedCulture"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>Piano</li>
        </value>
    </Operation>

    <!-- Spacer -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "CataphractArmor"
                or defName = "SpecializedLimbs"
                or defName = "CompactWeaponry"
                or defName = "VenomSynthesis"
            ]
        </xpath>
        <value>
            <tab>DuneRef_Hidden</tab>
        </value>
    </Operation>

    <!-- Conditional because EPOE adds tab -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/ResearchProjectDef[defName = "BrainWiring"]/tab</xpath>
        <match Class="PatchOperationReplace">
            <xpath>Defs/ResearchProjectDef[defName = "BrainWiring"]/tab</xpath>
            <value>
                <tab>DuneRef_Hidden</tab>
            </value>
        </match>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/ResearchProjectDef[defName = "BrainWiring"]</xpath>
            <value>
                <tab>DuneRef_Hidden</tab>
            </value>
        </nomatch>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "CataphractArmor"
                or defName = "BrainWiring"
                or defName = "SpecializedLimbs"
                or defName = "CompactWeaponry"
                or defName = "VenomSynthesis"
            ]/prerequisites
        </xpath>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "BrainWiring"
                or defName = "SpecializedLimbs"
                or defName = "CompactWeaponry"
            ]/hiddenPrerequisites
        </xpath>
    </Operation>

    <!-- Add techs to RimCivTechTree researches -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_AdvancedShields"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>CataphractArmor</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_Medicine"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>SpecializedLimbs</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_Cybernetics"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>CompactWeaponry</li>
            <li>VenomSynthesis</li>
        </value>
    </Operation>

    <!-- Ultra -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "ArtificialMetabolism"
                or defName = "NeuralComputation"
                or defName = "SkinHardening"
                or defName = "HealingFactors"
                or defName = "FleshShaping"
                or defName = "MolecularAnalysis"
                or defName = "CircadianInfluence"
            ]
        </xpath>
        <value>
            <tab>DuneRef_Hidden</tab>
        </value>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "ArtificialMetabolism"
                or defName = "NeuralComputation"
                or defName = "SkinHardening"
                or defName = "HealingFactors"
                or defName = "FleshShaping"
                or defName = "MolecularAnalysis"
                or defName = "CircadianInfluence"
            ]/prerequisites
        </xpath>
    </Operation>

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "ArtificialMetabolism"
                or defName = "NeuralComputation"
                or defName = "SkinHardening"
                or defName = "HealingFactors"
                or defName = "FleshShaping"
                or defName = "MolecularAnalysis"
                or defName = "CircadianInfluence"
            ]/hiddenPrerequisites
        </xpath>
    </Operation>

    <!-- Add techs to RimCivTechTree researches -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_Bioregeneration"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>ArtificialMetabolism</li>
            <li>NeuralComputation</li>
            <li>SkinHardening</li>
            <li>HealingFactors</li>
            <li>FleshShaping</li>
            <li>MolecularAnalysis</li>
            <li>CircadianInfluence</li>
        </value>
    </Operation>

</Patch>