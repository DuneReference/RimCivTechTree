<?xml version="1.0" encoding="utf-8" ?>
<Patch>

    <!-- Move mods research to hidden tab -->

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/ResearchProjectDef[
                   @Name = "PRF_CultivatorResearch"
                or @Name = "PRF_AnimalStationResearch"
                or @Name = "PRF_AssemblersResearch"
                or @Name = "PRF_BatteriesResearch"
                or @Name = "PRF_CommonResearch"
                or @Name = "PRF_BeltsResearch"
                or @Name = "PRF_DroneResearch"
                or @Name = "PRF_MiningResearch"
                or @Name = "PRF_SALResearch"
                or @Name = "PRF_StorageResearch"
            ]/tab
        </xpath>
        <value>
            <tab>DuneRef_Hidden</tab>
        </value>
    </Operation>

    <!-- remove prerequisites so no funky stuff happens when we try to unlock them automatically -->

    <Operation Class="PatchOperationRemove">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "PRF_AutomaticFarmingI"
                or defName = "PRF_AnimalStations"
                or defName = "PRF_AutomaticFarmingII"
                or defName = "PRF_AnimalStationsII"
                or defName = "PRF_AutomaticFarmingIII"
                or defName = "PRF_AnimalStationsIII"
                or defName = "PRF_SelfCooking"
                or defName = "PRF_SelfCookingII"
                or defName = "PRF_MetalRefining"
                or defName = "PRF_MachineLearning"
                or defName = "PRF_MagneticTape"
                or defName = "PRF_UniversalAutocrafting"
                or defName = "PRF_SelfCorrectingAssemblers"
                or defName = "PRF_SelfCorrectingAssemblersII"
                or defName = "PRF_EnhancedBatteries"
                or defName = "PRF_LargeBatteries"
                or defName = "PRF_VeryLargeBatteries"
                or defName = "PRF_CoreTierO"
                or defName = "PRF_CoreTierI"
                or defName = "PRF_CoreTierII"
                or defName = "PRF_CoreTierIII"
                or defName = "PRF_CoreTierIV"
                or defName = "PRF_BeltsI"
                or defName = "PRF_BeltsII"
                or defName = "PRF_BeltsIII"
                or defName = "PRF_BasicDrones"
                or defName = "PRF_ImprovedDrones"
                or defName = "PRF_AdvancedDrones"
                or defName = "PRF_AutonomousMining"
                or defName = "PRF_AutonomousMiningII"
                or defName = "PRF_AutonomousMiningIII"
                or defName = "PRF_SALResearchI"
                or defName = "PRF_SALResearchII"
                or defName = "PRF_SALResearchIII"
                or defName = "PRF_SALResearchIV"
                or defName = "PRF_SALResearchV"
                or defName = "PRF_SALResearchVII"
                or defName = "PRF_SALResearchVI"
                or defName = "PRF_SALResearchVIII"
                or defName = "PRF_SALGodlyCrafting"
                or defName = "PRF_Crates"
                or defName = "PRF_SteelCrates"
                or defName = "PRF_StorageIO"
                or defName = "PRF_StorageIO_II"
            ]/prerequisites
        </xpath>
    </Operation>

    <!-- Add techs to RimCivTechTree researches -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_AdvancedAI"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_AutomaticFarmingI</li>
            <li>PRF_AnimalStations</li>
            <li>PRF_AnimalStationsII</li>
            <li>PRF_SelfCooking</li>
            <li>PRF_SelfCookingII</li>
            <li>PRF_AutomaticFarmingII</li>
            <li>PRF_MachineLearning</li>
            <li>PRF_CoreTierII</li>
            <li>PRF_BeltsIII</li>
            <li>PRF_AutonomousMining</li>
            <li>PRF_AutonomousMiningII</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_PredictiveSystems"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_AutomaticFarmingIII</li>
            <li>PRF_AnimalStationsIII</li>
            <li>PRF_SelfCorrectingAssemblers</li>
            <li>PRF_CoreTierIII</li>
            <li>PRF_SALResearchIII</li>
            <li>PRF_SALResearchIV</li>
            <li>PRF_SALResearchVII</li>
            <li>PRF_SALResearchVI</li>
            <li>PRF_SALResearchVIII</li>
            <li>PRF_StorageIO</li>
            <li>PRF_StorageIO_II</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_Composites"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_MetalRefining</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_Computers"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_MagneticTape</li>
            <li>PRF_CoreTierI</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_Robotics"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_UniversalAutocrafting</li>
            <li>PRF_BasicDrones</li>
            <li>PRF_ImprovedDrones</li>
            <li>PRF_SALResearchI</li>
            <li>PRF_SALResearchII</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_QuantumIndustry"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_SelfCorrectingAssemblersII</li>
            <li>PRF_CoreTierIV</li>
            <li>PRF_SALResearchV</li>
            <li>PRF_SALGodlyCrafting</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_SyntheticMaterials"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_EnhancedBatteries</li>
            <li>PRF_LargeBatteries</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_AdvancedPowerCells"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_VeryLargeBatteries</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_Industrialization"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_CoreTierO</li>
            <li>PRF_SteelCrates</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_ReplaceableParts"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_BeltsI</li>
            <li>PRF_BeltsII</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_SmartMaterials"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_AdvancedDrones</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_AdvancedLasers"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_AutonomousMiningIII</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchProjectDef[
                   defName = "DuneRef_Woodworking"
            ]/modExtensions/li[@Class="DuneRef_RimCivTechTree.ResearchUnlocks"]/researchUnlocks
        </xpath>
        <value>
            <li>PRF_Crates</li>
        </value>
    </Operation>

    <!-- Hide tabs created by this mod -->

    <Operation Class="PatchOperationAdd">
        <xpath>
            Defs/ResearchTabDef[defName = "Automation"]
        </xpath>
        <value>
            <modExtensions>
                <li Class="DuneRef_RimCivTechTree.HiddenTab">
                    <hidden>True</hidden>
                </li>
            </modExtensions>
        </value>
    </Operation>

    <!-- Moving Individual items to different techs -->

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/TerrainDef[
                   @Name = "PRF_ConcreteFloorBase"
            ]/researchPrerequisites
        </xpath>
        <value>
            <researchPrerequisites Inherit="False">
                <li>DuneRef_Industrialization</li>
            </researchPrerequisites>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/ThingDef[
                   defName = "PRF_FermentingBarrel"
            ]/researchPrerequisites
        </xpath>
        <value>
            <researchPrerequisites Inherit="False">
                <li>PRF_SelfCooking</li>
            </researchPrerequisites>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/ThingDef[
                   defName = "PRF_FurnaceII"
            ]/researchPrerequisites
        </xpath>
        <value>
            <researchPrerequisites Inherit="False">
                <li>DuneRef_Electronics</li>
            </researchPrerequisites>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/ThingDef[
                   defName = "PRF_StoneWorks"
                or defName = "TableRoboticMachining"
            ]/researchPrerequisites
        </xpath>
        <value>
            <researchPrerequisites Inherit="False">
                <li>DuneRef_Computers</li>
            </researchPrerequisites>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/ThingDef[
                   defName = "PRF_SALAutoMinerI"
                or defName = "PRF_GenericAnimalHarvester_II"
            ]/researchPrerequisites
        </xpath>
        <value>
            <researchPrerequisites Inherit="False">
                <li>DuneRef_PredictiveSystems</li>
            </researchPrerequisites>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/ThingDef[
                   defName = "PRF_SunWallLight"
            ]/researchPrerequisites
        </xpath>
        <value>
            <researchPrerequisites Inherit="False">
                <li>DuneRef_Electronics</li>
                <li>DuneRef_Ecology</li>
            </researchPrerequisites>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/ThingDef[
                   defName = "PRF_RecipeDatabase"
            ]/researchPrerequisites
        </xpath>
        <value>
            <researchPrerequisites Inherit="False">
                <li>DuneRef_Nanotechnology</li>
            </researchPrerequisites>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>
            Defs/ThingDef[
                   defName = "PRF_16k_Battery"
                or defName = "PRF_4k_Battery"
            ]/researchPrerequisites
        </xpath>
        <value>
            <researchPrerequisites Inherit="False">
                <li>DuneRef_Electronics</li>
                <li>DuneRef_SyntheticMaterials</li>
            </researchPrerequisites>
        </value>
    </Operation>

</Patch>